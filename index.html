<html>
    <body>
        <button onclick="onButtonClick()">
            Click this button
        </button>
        <br>
        <div class="resultBlock">
            <label>Major: </label>
            <textarea id="major"></textarea>
            <label>Minor:</label>
            <textarea id="minor"></textarea>
        </div>
        <script>
            function onButtonClick()
            {
                navigator.bluetooth.requestLEScan({
                    keepRepeatedDevices: true,
                    acceptAllAdvertisements: true
                })
                .then(() => {
                    navigator.bluetooth.addEventListener('advertisementreceived', event => {                                                
                        let appData = event.manufacturerData.get(0x004C);                        
                        console.log(appData);
                        if (appData === undefined) {
                            return;
                        }

                        if (appData.byteLength < 23 || appData.byteLength > 31) {
                            return;
                        }
                        
                        let major = appData.getUint16(18, false);
                        let minor = appData.getUint16(20, false);
                        let txPowerAt1m = -appData.getInt8(22);
                        let pathLossVs1m = txPowerAt1m - event.rssi;
                        console.log('major: ' + major);
                        console.log('minor: ' + minor);
                        console.log('txPower: ' + txPowerAt1m);
                        console.log('pathLoss: ' + pathLossVs1m);
                        document.getElementById('major').value = major;
                        document.getElementById('minor').value = minor;

                    })
                });
            }
        </script>
    </body>
</html>
